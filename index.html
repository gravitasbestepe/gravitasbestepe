<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Air Quality Tracker</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; }
  #mapGlobal, #mapLocal { height: 40vh; margin-bottom:10px; }
  #controls { padding:10px; background:#f4f4f4; }
  #deviceAgency, #myBeacons, #rulesAdvice { padding:10px; border-top:1px solid #ccc; }
  select { padding:5px; margin-left:5px; }
  button { padding:5px 10px; margin-left:5px; cursor:pointer; }
</style>
</head>
<body>

<div id="controls">
  <input type="text" id="addressInput" placeholder="Enter city or address">
  <button id="searchBtn">Search</button>
  <button id="locateBtn">Locate Me</button>
  <select id="langSelect">
    <option value="en">English</option>
    <option value="tr">Türkçe</option>
  </select>
</div>

<h2>Global Emission Map</h2>
<div id="mapGlobal"></div>

<h2>Local Map</h2>
<div id="mapLocal"></div>

<div id="deviceAgency">
  <h3>Device Agency</h3>
  <p>Manage your devices here.</p>
</div>

<div id="myBeacons">
  <h3>My Beacons</h3>
  <p>Track your beacons.</p>
</div>

<div id="rulesAdvice">
  <h3>Rules & Advice</h3>
  <p>Air quality advice will appear here.</p>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const TOKEN = "9263e25a74b0d93c30387fa753ec876f19869d38";

const mapGlobal = L.map('mapGlobal').setView([20,0], 2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom:19 }).addTo(mapGlobal);

const dangerousLocations = [
  {lat:40.7128, lon:-74.006, aqi:180, name:"New York"},
  {lat:39.9042, lon:116.407, aqi:220, name:"Beijing"},
  {lat:28.6139, lon:77.209, aqi:160, name:"Delhi"},
  {lat:-23.5505, lon:-46.6333, aqi:170, name:"Sao Paulo"}
];

dangerousLocations.forEach(loc => {
  L.circle([loc.lat, loc.lon], {
    color:'red',
    fillColor:'red',
    fillOpacity:0.6,
    radius:50000
  }).addTo(mapGlobal).bindPopup(`${loc.name} AQI: ${loc.aqi}`);
});

const mapLocal = L.map('mapLocal').setView([39.925, 32.866], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom:19 }).addTo(mapLocal);
let localMarker = null;

function updateLocalMarker(lat, lon, label){
  if(localMarker) mapLocal.removeLayer(localMarker);
  localMarker = L.marker([lat, lon]).addTo(mapLocal).bindPopup(label).openPopup();
  mapLocal.setView([lat, lon], 12);
}

document.getElementById("locateBtn").addEventListener("click", ()=>{
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos=>{
      updateLocalMarker(pos.coords.latitude, pos.coords.longitude, "Your Location");
    },()=>alert("Unable to get location"));
  } else alert("Geolocation not supported");
});

mapLocal.on('click', e=>{
  updateLocalMarker(e.latlng.lat, e.latlng.lng, `Selected Point (${e.latlng.lat.toFixed(3)}, ${e.latlng.lng.toFixed(3)})`);
});

document.getElementById("searchBtn").addEventListener("click", ()=>{
  const query = document.getElementById("addressInput").value;
  if(!query) return alert("Enter a city or address");
  fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`)
  .then(res=>res.json())
  .then(data=>{
    if(data && data.length>0){
      const loc = data[0];
      updateLocalMarker(parseFloat(loc.lat), parseFloat(loc.lon), loc.display_name);
    } else alert("Location not found");
  }).catch(()=>alert("Error searching location"));
});

document.getElementById("langSelect").addEventListener("change", e=>{
  const val = e.target.value;
  if(val==="tr"){
    document.querySelector("#deviceAgency h3").textContent="Cihaz Yönetimi";
    document.querySelector("#myBeacons h3").textContent="Benim Beacons";
    document.querySelector("#rulesAdvice h3").textContent="Kurallar & Tavsiyeler";
    document.querySelector("#rulesAdvice p").textContent="Hava kalitesi tavsiyeleri burada görünecek.";
  } else {
    document.querySelector("#deviceAgency h3").textContent="Device Agency";
    document.querySelector("#myBeacons h3").textContent="My Beacons";
    document.querySelector("#rulesAdvice h3").textContent="Rules & Advice";
    document.querySelector("#rulesAdvice p").textContent="Air quality advice will appear here.";
  }
});
</script>
</body>
</html>
