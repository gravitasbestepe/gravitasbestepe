<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Global Air Quality & Emission Simulator</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  :root{--bg:#fafafa;--card:#fff;--muted:#666}
  body{font-family:Arial,Helvetica,sans-serif;margin:0;background:var(--bg);color:#222}
  header{display:flex;align-items:center;gap:12px;padding:10px 14px;background:#0b5;box-shadow:0 2px 8px rgba(0,0,0,.06)}
  header h1{font-size:18px;margin:0;flex:1}
  nav{display:flex;gap:8px}
  nav button{background:transparent;border:0;padding:8px 10px;border-radius:6px;cursor:pointer}
  nav button.active{background:rgba(255,255,255,.9)}
  main{padding:12px}
  .grid{display:grid;grid-template-columns:1fr;gap:12px}
  .card{background:var(--card);padding:10px;border-radius:8px;box-shadow:0 4px 16px rgba(12,12,12,.04)}
  #map, #globalMap, #interactiveMap{height:420px;border-radius:8px;margin-top:10px}
  #controls{display:flex;gap:6px;align-items:center;flex-wrap:nowrap;padding:8px;background:#f4f4f4;border-radius:8px}
  #addressInput{flex:1;padding:6px;border-radius:6px;border:1px solid #ccc}
  #resultList{position:absolute;left:0;right:0;top:36px;background:white;box-shadow:0 6px 18px rgba(0,0,0,.08);border-radius:6px;z-index:1000;max-height:220px;overflow:auto;display:none}
  .resultItem{padding:8px;border-bottom:1px solid #eee;cursor:pointer}
  .resultItem:hover{background:#f0f7ff}
  .aqi-bar{height:18px;width:100%;background:#ddd;margin:4px 0;border-radius:5px;overflow:hidden}
  .aqi-fill{height:100%;width:0%;background:green;text-align:center;color:white;font-weight:bold;font-size:12px}
  .btn{display:inline-block;padding:8px 10px;border-radius:6px;border:1px solid #bbb;background:white;cursor:pointer}
  .lang-switch{margin-left:10px;border:1px solid #fff;padding:4px 8px;border-radius:6px;background:#fff;cursor:pointer}
  @media(max-width:900px){#map,#globalMap,#interactiveMap{height:300px}}
</style>
</head>
<body>
<header>
  <h1 id="appTitle">Global Air Quality Simulator</h1>
  <nav>
    <button id="nav-home" class="active">Home</button>
    <button id="nav-global">Global AQI Map</button>
    <button id="nav-interactive">Interactive Map</button>
  </nav>
  <select id="langSelect" class="lang-switch">
    <option value="en">English</option>
    <option value="tr">T√ºrk√ße</option>
  </select>
</header>
<main>
  <!-- Home Page -->
  <section id="page-home">
    <div class="card">
      <div id="controls">
        <div style="position:relative;flex:1">
          <input id="addressInput" placeholder="Enter city, street or location" autocomplete="off" />
          <div id="resultList"></div>
        </div>
        <button id="locateBtn" class="btn">üìç Locate Me</button>
      </div>
      <h3 id="locationLabel">Location: ‚Äî</h3>
      <div class="aqi-bar"><div id="aqiBar" class="aqi-fill">‚Äî</div></div>
      <p id="aqiText">AQI: ‚Äî</p>
      <p id="dominantPollutant">Dominant Pollutant: ‚Äî</p>
      <h4>Pollutants:</h4>
      <ul id="pollutants"></ul>
    </div>
  </section>

  <!-- Global AQI Map -->
  <section id="page-global" style="display:none">
    <div class="card">
      <h2 id="globalTitle">Global AQI Map</h2>
      <div id="globalMap"></div>
      <div style="margin-top:8px" id="globalSummary"></div>
    </div>
  </section>

  <!-- Interactive Map -->
  <section id="page-interactive" style="display:none">
    <div class="card">
      <div id="controlsInteractive">
        <div style="position:relative;flex:1">
          <input id="addressInput2" placeholder="Enter city, street or location" autocomplete="off" />
          <div id="resultList2"></div>
        </div>
        <button id="locateBtn2" class="btn">üìç Locate Me</button>
      </div>
      <div id="interactiveMap"></div>
      <h3 id="locationLabel2">Location: ‚Äî</h3>
      <div class="aqi-bar"><div id="aqiBar2" class="aqi-fill">‚Äî</div></div>
      <p id="aqiText2">AQI: ‚Äî</p>
      <p id="dominantPollutant2">Dominant Pollutant: ‚Äî</p>
      <h4>Pollutants:</h4>
      <ul id="pollutants2"></ul>
    </div>
  </section>
</main>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const WAQI_TOKEN="9263e25a74b0d93c30387fa753ec876f19869d38";
const NOMINATIM_BASE="https://nominatim.openstreetmap.org";

// --- Multi-language ---
const translations = {
  en: {
    home: "Home",
    global: "Global AQI Map",
    interactive: "Interactive Map",
    locateMe: "üìç Locate Me",
    enterAddress: "Enter city, street or location",
    location: "Location",
    dominantPollutant: "Dominant Pollutant",
    aqi: "AQI",
    pollutants: "Pollutants",
    appTitle: "Global Air Quality Simulator",
    globalSummary: "Sample country data (simulated)"
  },
  tr: {
    home: "Anasayfa",
    global: "Global AQI Haritasƒ±",
    interactive: "Etkile≈üimli Harita",
    locateMe: "üìç Konumumu Bul",
    enterAddress: "≈ûehir, sokak veya adres girin",
    location: "Konum",
    dominantPollutant: "Baskƒ±n Kirletici",
    aqi: "AQI",
    pollutants: "Kirleticiler",
    appTitle: "Global Hava Kalitesi Sim√ºlat√∂r√º",
    globalSummary: "√ñrnek √ºlke verileri (sim√ºle)"
  }
};

let currentLang = 'en';
function setLanguage(lang){
  currentLang = lang;
  document.getElementById('nav-home').textContent = translations[lang].home;
  document.getElementById('nav-global').textContent = translations[lang].global;
  document.getElementById('nav-interactive').textContent = translations[lang].interactive;
  document.getElementById('locateBtn').textContent = translations[lang].locateMe;
  document.getElementById('locateBtn2').textContent = translations[lang].locateMe;
  document.getElementById('addressInput').placeholder = translations[lang].enterAddress;
  document.getElementById('addressInput2').placeholder = translations[lang].enterAddress;
  document.getElementById('appTitle').textContent = translations[lang].appTitle;
  document.getElementById('globalTitle').textContent = translations[lang].global;
  document.getElementById('globalSummary').innerHTML = `<div class="muted">${translations[lang].globalSummary}:</div>`;
  updateAQIUI(currentAQIData, translations[lang].location);
  updateAQIUI2(currentAQIData2, translations[lang].location);
}
document.getElementById('langSelect').addEventListener('change', e=>setLanguage(e.target.value));

// --- SPA Navigation ---
const pages = {
  home: document.getElementById('page-home'),
  global: document.getElementById('page-global'),
  interactive: document.getElementById('page-interactive')
};
function show(page){
  Object.values(pages).forEach(p=>p.style.display='none');
  pages[page].style.display='block';
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  document.getElementById('nav-'+page).classList.add('active');
  setTimeout(()=>{
    if(window.globalMap) window.globalMap.invalidateSize();
    if(window.interactiveMap) window.interactiveMap.invalidateSize();
    if(window.homeMap) window.homeMap.invalidateSize();
  },200);
}
document.getElementById('nav-home').addEventListener('click',()=>show('home'));
document.getElementById('nav-global').addEventListener('click',()=>show('global'));
document.getElementById('nav-interactive').addEventListener('click',()=>show('interactive'));

// --- Map Setup ---
let homeMap = L.map('map',{center:[20,0],zoom:2}); 
let globalMap = L.map('globalMap',{center:[20,0],zoom:2});
let interactiveMap = L.map('interactiveMap',{center:[20,0],zoom:2});
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(homeMap);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(globalMap);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(interactiveMap);

// --- Helpers ---
async function nominatimSearch(q){const res=await fetch(`${NOMINATIM_BASE}/search?format=json&addressdetails=1&limit=10&q=${encodeURIComponent(q)}`,{headers:{'Accept-Language':'en'}});return res.json();}
async function nominatimReverse(lat,lon){const res=await fetch(`${NOMINATIM_BASE}/reverse?format=json&lat=${lat}&lon=${lon}&addressdetails=1`,{headers:{'Accept-Language':'en'}});return res.json();}

function debounce(fn,wait){let t;return function(...args){clearTimeout(t);t=setTimeout(()=>fn.apply(this,args),wait);};}

// --- AQI Update ---
let currentAQIData = null;
function updateAQIUI(data,label){
  currentAQIData = data;
  document.getElementById('locationLabel').textContent = `${translations[currentLang].location}: ${label||'‚Äî'}`;
  const aqi = data&&data.aqi?data.aqi:null;
  document.getElementById('aqiText').textContent = `${translations[currentLang].aqi}: ${aqi!==null?aqi:'‚Äî'}`;
  document.getElementById('dominantPollutant').textContent = `${translations[currentLang].dominantPollutant}: ${data&&data.dominentpol?data.dominentpol.toUpperCase():'‚Äî'}`;
  let color='green';
  if(aqi===null) color='#999'; else if(aqi<=50) color='green'; else if(aqi<=100) color='yellow'; else if(aqi<=150) color='orange'; else if(aqi<=200) color='red'; else if(a
